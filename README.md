# 3D Semaphore Signal Simulator
OpenGLを用いた3D手旗信号シミュレーションツールです。
コマンドプロンプトから入力された文字列を反映し、3Dキャラクターが手旗信号のアニメーションを行います。
<img width="1360" height="654" alt="Image" src="https://github.com/user-attachments/assets/a0ad281e-3ada-4d7c-8517-ac223ced45ab" />
## 1. ソフトウェア概要
「手旗信号」とは、右手に赤旗、左手に白旗を持って行う視覚通信手段です。
本プログラムは、海兵学校の手旗信号教官をイメージしたロボット「ロボタ」が、ユーザーの入力した文字列を手旗信号に変換して伝達します。
また、文字入力はキーボード・マウスに対応し、旗を持った状態でも入力可能となります。

### モード構成
システムは以下の3つのモードで動作します。

* **選択モード:** 起動直後のメニュー画面。モードの切り替えを行います。
* **手旗信号モード (Mode 1):** 入力されたテキストを手旗信号アニメーションに変換します。
* **AI対話・相談モード (Mode 2):** 指導教官ロボタとお話ができます。
* **散策（走り込み）モード (Mode 3):** ロボットを操作して3D空間内を自由に移動できます。

## 2. 操作方法 (Controls)

### 2.1 文字列操作 (手旗信号モード)
* **入力:** コマンドプロンプトに文字列を入力してEnterを押すと、アニメーションが開始されます。
    * ※この際、カタカナや漢字が入力されても、ひらがなに瞬時に直し、各文字に対応する動きを描画します。
* **待機状態:** アニメーション実行中以外は、画面左上に「Waiting for input」が表示され、入力待ち状態となります。

### 2.2 ロボット移動操作 (散策モード)
左手で操作しやすいよう、WASDキーに割り当てられています。

| キー | 動作 | 補足 |
| :--- | :--- | :--- |
| **`W`** | 前進 | 進行方向を向き、足を交互に出して歩行します。 |
| **`A`** | 左移動 | |
| **`S`** | 後退 | |
| **`D`** | 右移動 | |

* **特徴:** 部屋の大きさ（歩行範囲）に合わせて移動制限があります。また、カメラに近づくと顔に影がかかるライティング調整を行っています。

### 2.3 視点操作
右手（マウス）での操作を想定した設計になっています。

| 操作 | 動作 | 詳細 |
| :--- | :--- | :--- |
| **右クリック + 上下ドラッグ** | 拡大・縮小 | Z軸上の移動（ズーム） |
| **右クリック + 左右ドラッグ** | 回転（ロール） | Z軸回転 |
| **左クリック + ドラッグ** | 視点移動 | X軸・Y軸周りの視点回転 |

### 2.4 その他の機能

| 機能 | キー | 使用可能モード | 説明 |
| :--- | :--- | :--- | :--- |
| **一時停止/再生** | **`Space`** | 手旗信号 | アニメーションを一時停止します。停止中は「STOP」と表示されます。 |
| **初期化 (Reset)** | **`R`** | 全モード | 移動したロボットの位置や、変更した視点を初期位置に戻します。 |
| **モード選択へ** | **`C`** | 散策モード | 散策モードを終了し、モード選択画面へ戻ります。 |
| **終了** | **`Esc`** | 全モード | ソフトウェアを終了します。 |

## 3. アルゴリズム (Algorithm)
**「文字単位」のアニメーション生成**
本システムでは、入力された文字列を単語としてではなく、個々の文字の連なりとして処理しています。
ひらがな一文字ごとに「動きの流れ」「反転判定」「ローマ字表記」を定義し、それに基づいて腕の角度や座標を計算・出力します。これにより、どのような文字列の組み合わせであっても、柔軟かつ連続的な手旗信号表現が可能になっています。

## 4. モデリング (Modeling)
* **キャラクターデザイン:**
    手旗信号が艦艇間の通信手段であることを踏まえ、セーラー服を着用した海兵学校の教官ロボットをモデリングしました。親しみやすさを意識したデザインです。
* **描画処理のこだわり:**
    ボディ全体にはZバッファ（深度バッファ）による陰面消去を適用していますが、**旗（フラッグ）部分のみ陰面消去を行わない**設定にしています。
    これにより、手を体の前でクロスさせるような動作の際にも、旗が体に埋め込まれて見えなくなることを防ぎ、信号としての視認性を確保しています。

## 5. システム構成・技術詳細 (System Architecture)

本システムは、 **「高度な言語処理を行うPythonクライアント」** と **「リアルタイム3D描画を行うC++(OpenGL)サーバー」** をTCPソケット通信で連携させたハイブリッド構成となっています。

### 5.1 ソケット通信によるプロセス間連携 (Socket Communication)
論理処理と描画処理を分離するため、ローカルループバックアドレス（localhost）を介した **TCPソケット通信** を採用しています。

* **通信フロー:**
    1.  **Python側 (Client):** ユーザーの音声/テキスト入力を受け取り、AIによる正規化・応答生成を行った後、制御コマンド（モードID + テキストデータ）を送信します。
    2.  **C++側 (Server):** パケットを受信・解析し、OpenGLウィンドウ上でアニメーションを実行します。
    3.  **同期制御:** アニメーション終了時には、C++側からPython側へ完了通知を送ることで、音声対話と身体動作のタイミング同期を行っています。

### 5.2 生成AIの活用 (AI Integration)
キャラクターの頭脳として、**OpenAI API (GPT-4o-mini)** を導入しています。

* **ロールプレイ制御:** システムプロンプトにより「海兵学校の熱血教官」という人格を定義。ユーザーの入力を単に変換するだけでなく、教官としての叱咤激励やアドバイスを返答します。
* **テキスト正規化:** 手旗信号アニメーションの入力となるよう、漢字やカタカナ、混じりの入力を、文脈を考慮して正確に「ひらがな」へ変換する処理もAIが担っています。

### 5.3 音声認識・音声合成 (Voice Interaction)
キーボード操作だけでなく、声による直感的なインタラクションを実現しています。

* **音声認識 (Speech-to-Text):**
    `SpeechRecognition` ライブラリとGoogleの音声認識エンジンを使用し、マイクからの入力をテキスト化します。
* **音声合成 (Text-to-Speech):**
    **OpenAI Audio API (TTS-1)** を採用。教官のキャラクターに合わせた低音の男性ボイス（Onyxモデル）を使用し、低遅延かつ高品質な応答音声を出力します。

### 5.4 技術スタック一覧
| カテゴリ | 使用技術 |
| :--- | :--- |
| **描画・シミュレーション** | C, OpenGL (GLUT), 独自行列演算 |
| **制御・AIクライアント** | Python 3.11.2 |
| **通信プロトコル** | TCP/IP Socket |
| **AIモデル** | GPT-4o-mini (Chat), tts-1 (Audio) |
| **音声認識** | Google Speech Recognition API |

## 6. セットアップ (Setup)

### 6.1 環境変数の設定 (.env)
本プロジェクトを実行するには、OpenAIのAPIキーが必要です。
プロジェクトルートに `.env` ファイルを作成し、以下のように記述してください。

1. `env.example` ファイルをコピーして `.env` にリネームします。
2. `.env` ファイル内の `OPENAI_API_KEY` にご自身のAPIキーを貼り付けてください。
3. TCPソケット通信の設定(HOSR, PORT)もデフォルトでも使えますが、自身の環境に合わせて適宜変更してください。

### 6.2 ライブラリの準備
以下のコマンドで仮想環境を作成し、必要なライブラリを一括インストールしてください。
# 1. 仮想環境の作成と有効化
python -m venv venv
.\venv\Scripts\activate
# 2. pipのアップグレード
python -m pip install --upgrade pip
# 3. 依存ライブラリのインストール
pip install -r requirements.txt
